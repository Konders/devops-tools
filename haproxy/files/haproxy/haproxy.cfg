defaults
    timeout connect 5s
    timeout client 5s
    timeout server 30s
    mode http

frontend web_proxy
    bind *:80
    
    #ACL on path
    acl path_check1 path -m beg -i /api/v1
    acl path_check1 path -m beg -i /api/v2
    # Important note: Use above ACLs in according of their definition
    use_backend server1 if path_check1
    # Below is same as above
    #use_backend web-server if { path -m end -i /api/v1 }
    use_backend server2 if path_check2
    
    #ACL on url parameters
    #Route in according to Region
    acl urlparam1 url_param(region) -i -m reg w.*
    acl urlparam1 url_param(region) -i -m str east north
    use_backend server1 if urlparam1
    use_backend server2 if urlparam2
    
    #ACL on header of either request (req.hdr) or response (res.hdr)
    #Route in according to subdomain
    acl header_check1 hdr_end(Host) -i -m str app1.mysite.ir
    acl header_check2 hdr_end(Host) -i -m str app2.mysite.ir
    use_backend server2 if header_check1
    use_backend server2 if header_check2

    #ACL on user agent
    acl header_check3 hdr_end(User-Agent) -i -m reg (Android|Iphone)
    use_backend server1
    #Default backend must be last line
    default_backend webs

backend webs
   mode http
   balance roundrobin
   server srv1 web1:80 check weight 4 maxconn 20 slowstart 10s
   server srv2 web2:80 check weight 4 maxconn 40 slowstart 20s

backend server1
    balance roundrobin
    server srv1 web1:80 check weight 4 maxconn 20 slowstart 10s
#    option forwardfor

backend server2
    balance roundrobin
    server srv2 web2:80 check weight 4 maxconn 40 slowstart 20s
